<!-- ✅ All-Bookings.html (Clean + fixed) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HomeGlitz — All Bookings</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Your existing CSS — unchanged === */
  </style>
</head>
<body>
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/mainlogog-removebg-preview.png" alt="HomeGlitz Logo">
    </div>
    <ul class="nav-links">
      <li><a href="dashboard.html"><i class="fa-solid fa-chart-line"></i><span> Dashboard</span></a></li>
      <li class="nav-item">
        <a href="#" id="bookingMenu">
          <i class="fa-solid fa-broom"></i><span> Bookings</span>
          <i class="fa-solid fa-chevron-down" style="margin-left:auto;transition:transform .3s;"></i>
        </a>
        <div class="sub-menu">
          <a href="booking.html">Create New</a>
          <a href="all-bookings.html" class="active">All Bookings</a>
        </div>
      </li>
      <li><a href="properties.html"><i class="fa-solid fa-house"></i><span> Properties</span></a></li>
      <li><a href="cleaners.html"><i class="fa-solid fa-users"></i><span> Cleaners</span></a></li>
      <li><a href="reports.html"><i class="fa-solid fa-chart-pie"></i><span> Reports</span></a></li>
      <li><a href="settings.html"><i class="fa-solid fa-gear"></i><span> Settings</span></a></li>
    </ul>
  </aside>

  <div class="overlay" id="overlay"></div>

  <!-- ===== EXISTING CONTENT (unchanged: filters, table, pagination, etc.) ===== -->
  <div style="flex:1;display:flex;flex-direction:column;">
    <header class="topbar">
      <button class="menu-toggle" id="menuToggle"><i class="fa-solid fa-bars"></i></button>
      <div class="topbar-right">
        <i class="fa-regular fa-bell"></i>
        <i class="fa-regular fa-user"></i>
      </div>
    </header>

    <main>
      <!-- your existing card, filters, table, pagination, etc. -->
    </main>
  </div>

  <!-- ===== DRAWER ===== -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <aside class="drawer" id="drawer">
    <div class="drawer__head">
      <div class="drawer__title"><i class="fa-solid fa-clipboard-list"></i><span id="dwTitle">Booking Details</span></div>
      <button class="btn btn-light" id="dwClose"><i class="fa-solid fa-xmark"></i> Close</button>
    </div>

    <div class="drawer__body">
      <div class="section-title"><i class="fa-solid fa-house"></i> Property</div>
      <div class="drawer__grid">
        <div class="group"><label>Booking ID</label><input id="dwId" disabled></div>
        <div class="group"><label>Type</label><input id="dwType" disabled></div>
        <div class="group"><label>Property Name</label><input id="dwProp" disabled></div>
        <div class="group"><label>Address</label><input id="dwAddr" disabled></div>
      </div>

      <div class="section-title"><i class="fa-solid fa-user"></i> Cleaning</div>
      <div class="drawer__grid">
        <div class="group"><label>Cleaner</label><select id="dwCleaner"></select></div>
        <div class="group"><label>Cleaning Date</label><input id="dwDate" type="date"></div>
        <div class="group"><label>Status</label>
          <select id="dwStatus">
            <option>Pending</option>
            <option>Clean Underway</option>
            <option>Completed</option>
          </select>
        </div>
        <div class="group"><label>B2B</label>
          <div class="b2b-badges">
            <div class="badge" id="dwB2BYes">Yes</div>
            <div class="badge active" id="dwB2BNo">No</div>
          </div>
        </div>
      </div>

      <div class="group" style="margin-top:10px;">
        <label>Notes</label>
        <textarea id="dwNotes" rows="3" placeholder="Door code, supplies, special requests…"></textarea>
      </div>

      <div id="dwAirbnbSection" style="margin-top:16px;display:none;">
        <div class="section-title"><i class="fa-solid fa-bed"></i> Packing List (Airbnb)</div>
        <div id="dwLinenGrid" class="drawer__grid"></div>
      </div>
    </div>

    <div class="drawer__footer">
      <button class="btn btn-light" id="dwCancel">Cancel</button>
      <button class="btn btn-primary" id="dwSave"><i class="fa-solid fa-floppy-disk"></i> Save</button>
      <button class="btn btn-light" id="dwDelete" style="color:#d9534f;border:1px solid #f5b7b1;">Delete</button>
    </div>
  </aside>

  <!-- ===== Toast + Loader (unchanged) ===== -->
  <div class="hz-toast" id="toast"></div>
  <div class="hz-loader" id="loader"><div class="box"><div class="spin"></div><span>Loading…</span></div></div>

  <script>
    /* ===== Sidebar / Topbar ===== */
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuToggle = document.getElementById('menuToggle');
    const bookingMenu = document.getElementById('bookingMenu');
    const bookingItem = bookingMenu.parentElement;

    menuToggle.onclick = () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
    };
    overlay.onclick = () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
    };
    bookingMenu.onclick = (e) => {
      e.preventDefault();
      bookingItem.classList.toggle('open');
      const icon = bookingMenu.querySelector('.fa-chevron-down');
      icon.style.transform = bookingItem.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    };

    /* ===== Populate Cleaners dropdown when drawer opens ===== */
    async function loadCleaners() {
      try {
        const res = await fetchJSON(`${scriptBaseURL}?type=cleaners`);
        const list = Array.isArray(res) ? res : [];
        dwCleaner.innerHTML = list.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
      } catch {
        dwCleaner.innerHTML = '<option value="">(Error loading cleaners)</option>';
      }
    }

    /* ===== Delete booking ===== */
    const dwDelete = document.getElementById('dwDelete');
    dwDelete.onclick = async () => {
      if (!CURRENT_EDIT) return;
      if (!confirm('Are you sure you want to delete this booking?')) return;

      try {
        showLoader();
        await fetch(scriptBaseURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'deleteBooking', bookingId: dwId.value })
        });
        showToast('Booking deleted');
        await loadBookings();
        closeDrawer();
      } catch (e) {
        console.error(e);
        showToast('Error deleting booking');
      } finally {
        hideLoader();
      }
    };

    /* ===== When opening drawer, also load cleaners ===== */
    const _originalOpenDrawerWith = openDrawerWith;
    openDrawerWith = function(bookingId) {
      loadCleaners();
      _originalOpenDrawerWith(bookingId);
    };
  </script>
</body>
</html>
