<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HomeGlitz — Payments</title>

<link rel="icon" href="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root { 
    --primary:#0F72B4;
    --panel:#fff;
    --muted:#6c757d;
    --success:#16a34a;
    --danger:#ef4444;
  }
  *{box-sizing:border-box;font-family:'Montserrat',sans-serif}
  html,body{margin:0;background:#f5faff;color:#222}

  header.top{
    height:60px; display:flex; align-items:center;
    justify-content:space-between; background:#fff;
    padding:0 16px; border-bottom:1px solid #e6eef8;
  }
  header .brand{display:flex;align-items:center;gap:10px}
  header .brand img{height:36px}

  .wrap{display:flex;min-height:calc(100vh - 60px)}

  nav.side{
    width:220px;background:#fff;border-right:1px solid #e6eef8;
    padding:18px;display:flex;flex-direction:column;gap:12px;
  }
  nav.side .profile{display:flex;gap:12px;align-items:center}
  nav.side .avatar{
    width:44px;height:44px;border-radius:10px;background:#f0f6fb;
    display:flex;align-items:center;justify-content:center;
    font-weight:700;color:var(--primary);
  }
  nav.side a{
    padding:10px;border-radius:10px;text-decoration:none;
    color:var(--muted);display:flex;gap:10px;font-weight:600;
  }
  nav.side a.active{
    background:#f8fbff;color:var(--primary);
    box-shadow:0 6px 18px rgba(15,114,180,.06);
  }

  main.content{flex:1;padding:18px;overflow:auto}

  .card{
    background:#fff;padding:20px;border-radius:14px;
    border:1px solid #eaf2fb;
  }

  h2{margin:0;color:var(--primary);font-size:20px}

  .summary-box{
    display:grid;gap:14px;grid-template-columns:1fr 1fr;
    margin-top:14px;
  }
  .sum{
    background:#f8fbff;border-radius:12px;padding:16px;
    border:1px solid #e6eef8;
  }
  .sum .value{font-size:22px;font-weight:700}
  .sum .label{font-size:13px;color:var(--muted)}

  table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px}
  th,td{border-bottom:1px solid #eef2f7;padding:10px;text-align:left}
  tr:hover td{background:#fbfdff}

  .badge{
    padding:4px 8px;border-radius:99px;font-size:12px;font-weight:700;
  }
  .b-pending{background:#fff9da;color:#b07800}
  .b-approved{background:#eaffec;color:#0e7c33}
  .b-paid{background:#eaf4ff;color:#0a5ba8}

  @media(max-width:880px){
    nav.side{display:none}
    .wrap{flex-direction:column}
    header.top{padding:0 12px}
    .summary-box{grid-template-columns:1fr}
  }
</style>
</head>

<body>
<header class="top">
  <div class="brand">
    <img src="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png">
    <strong>HomeGlitz</strong>
  </div>
  <div>
    <span id="cleanerNameDisplay" style="margin-right:12px;color:var(--muted)"></span>
    <button id="btnLogout" style="padding:8px 12px;border-radius:8px;border:none;background:var(--primary);color:#fff;font-weight:700">Logout</button>
  </div>
</header>

<div class="wrap">

  <!-- SIDE NAV -->
  <nav class="side">
    <div class="profile">
      <div class="avatar" id="avatar">CL</div>
      <div>
        <div id="navName" class="name" style="font-weight:700"></div>
        <div id="navEmail" style="font-size:13px;color:var(--muted)"></div>
      </div>
    </div>

    <a href="/cleaner-portal.html"><i class="fa-solid fa-list-check"></i> My Jobs</a>
    <a href="/cleaner-payments.html" class="active"><i class="fa-solid fa-wallet"></i> Payments</a>
    <a href="/cleaner-account.html"><i class="fa-solid fa-gear"></i> Account</a>
  </nav>

  <main class="content">
    <div class="card">

      <h2>Payments</h2>

      <div class="summary-box">
        <div class="sum">
          <div class="value" id="totalEarnings">$0</div>
          <div class="label">Total Earnings</div>
        </div>
        <div class="sum">
          <div class="value" id="totalPaid">$0</div>
          <div class="label">Amount Paid</div>
        </div>
      </div>

      <h3 style="margin-top:24px;margin-bottom:10px;color:var(--primary)">Payment Requests</h3>

      <table>
        <thead>
          <tr>
            <th>Request ID</th>
            <th>Booking</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Requested</th>
          </tr>
        </thead>
        <tbody id="paymentsBody">
          <tr><td colspan="5" style="text-align:center;color:var(--muted);padding:20px">Loading…</td></tr>
        </tbody>
      </table>

    </div>
  </main>

</div>

<script>
const API = "https://homeglitz.raphaellevinders.workers.dev/";

const token  = localStorage.getItem("homeglitz_cleaner_token");
const name   = localStorage.getItem("homeglitz_cleaner_name");
const email  = localStorage.getItem("homeglitz_cleaner_email") || "";
const cleanerId = localStorage.getItem("homeglitz_cleaner_id");

if (!token) location.href = "/cleaner-login.html";

document.getElementById("navName").textContent = name || "";
document.getElementById("navEmail").textContent = email || "";
document.getElementById("avatar").textContent = (name||"CL").split(" ").map(s=>s[0]).join("").toUpperCase();
document.getElementById("cleanerNameDisplay").textContent = name||"";

document.getElementById("btnLogout").onclick = () => {
  localStorage.clear();
  location.href="/cleaner-login.html";
};

/* LOAD PAYMENTS */
async function loadPayments(){
  const body = { action:"getCleanerPayments", token };

  try{
    const res = await fetch(API, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(body)
    });

    const json = await res.json();
    if (!json.success) {
      alert(json.message || "Unable to load payments");
      return;
    }

    // Update totals
    document.getElementById("totalEarnings").textContent = "$" + (json.totalEarnings||0);
    document.getElementById("totalPaid").textContent     = "$" + (json.totalPaid||0);

    // Render table
    const tbody = document.getElementById("paymentsBody");
    if (!json.payments || json.payments.length===0){
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;padding:20px;color:var(--muted)">No payment requests</td></tr>`;
      return;
    }

    tbody.innerHTML = json.payments.map(p=>{
      const statusClass = 
        p.Status === "Pending" ? "b-pending" :
        p.Status === "Approved" ? "b-approved" :
        "b-paid";

      return `
        <tr>
          <td>${p["Request ID"]}</td>
          <td>${p["Booking ID"]}</td>
          <td>$${p.Amount}</td>
          <td><span class="badge ${statusClass}">${p.Status}</span></td>
          <td>${new Date(p["Requested At"]).toLocaleDateString()}</td>
        </tr>
      `;
    }).join("");

  }catch(err){
    console.error(err);
    alert("Network error");
  }
}

loadPayments();
</script>

</body>
</html>
