<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HomeGlitz â€” Cleaners</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #0F72B4;
      --primary-light: #f5faff;
      --text: #222;
      --muted: #6c757d;
      --panel: #fff;
      --border: #e4e9ef;
      --radius: 12px;
      --shadow: 0 6px 20px rgba(15,114,180,0.1);
      --transition: 0.3s ease;
      --success: #28a745;
      --danger: #dc3545;
    }

    * { box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
    html, body { margin: 0; padding: 0; overflow-x: hidden; }
    body { display: flex; min-height: 100vh; background: var(--primary-light); color: var(--text); }

    /* Sidebar & Topbar (unchanged) */
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 250px; background: var(--panel); border-right: 1px solid var(--border); box-shadow: var(--shadow); display: flex; flex-direction: column; padding: 20px 0; overflow-y: auto; z-index: 2000; }
    .sidebar .brand { display: flex; align-items: center; justify-content: center; margin-bottom: 30px; }
    .sidebar .brand img { height: 48px; }
    .nav-links { list-style: none; padding: 0; margin: 0; }
    .nav-links li a { display: flex; align-items: center; gap: 12px; padding: 14px 22px; color: var(--muted); font-weight: 500; text-decoration: none; transition: all var(--transition); }
    .nav-links li a:hover, .nav-links li a.active { background: var(--primary-light); color: var(--primary); border-left: 4px solid var(--primary); }
    .sub-menu { display: none; flex-direction: column; margin-left: 40px; font-size: 12px; }
    .nav-item.open .sub-menu { display: flex; }
    .topbar { height: 60px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 25px; box-shadow: var(--shadow); position: fixed; top: 0; left: 250px; right: 0; z-index: 1000; }

    main { flex: 1; margin-left: 250px; padding: 100px 40px 40px; background: var(--primary-light); }

    /* === Card & Table === */
    .card {
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 40px 50px;
    }

    .card__title {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: space-between; /* NEW: align filters + button horizontally */
      border-bottom: 2px solid rgba(15,114,180,0.1);
      padding-bottom: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 10px;
    }

    /* NEW: Filter bar */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .filter-bar input {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    .filter-bar select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 14px;
      color: var(--text);
    }

    table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden; }
    th, td { padding: 12px 16px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
    th { background: #f9fbfd; color: var(--primary); font-weight: 600; text-align: left; }
    tr:hover td { background: #f9fafb; }

    /* NEW: Active badges */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      color: #fff;
    }
    .badge.active { background: var(--success); }
    .badge.inactive { background: var(--danger); }

    .btn { border: none; border-radius: 8px; padding: 8px 12px; font-weight: 600; cursor: pointer; font-size: 14px; transition: 0.2s ease; }
    .btn.add { background: var(--primary); color: #fff; }

    /* Drawer styling unchanged */
    .drawer { position: fixed; bottom: 0; left: 50%; transform: translate(-50%, 100%); background: var(--panel); border-radius: 20px; box-shadow: 0 -6px 20px rgba(0,0,0,0.1); transition: transform 0.35s cubic-bezier(0.22, 1, 0.36, 1); z-index: 5000; width: 600px; max-width: 95%; max-height: 85vh; display: flex; flex-direction: column; }
    .drawer.active { transform: translate(-50%, 0); }

    /* Mobile */
    @media (max-width: 768px) {
      main { margin-left: 0; padding: 90px 12px 40px; }
      .card__title { flex-direction: column; align-items: flex-start; }
    }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.25); backdrop-filter: blur(3px); opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 4000; }
    .overlay.active { opacity: 1; visibility: visible; }

    .hz-toast { position: fixed; bottom: 24px; right: 24px; background: #0F72B4; color: #fff; padding: 12px 16px; border-radius: 10px; font-weight: 600; box-shadow: 0 10px 24px rgba(15,114,180,.25); opacity: 0; transform: translateY(16px); transition: .3s ease; z-index: 6000; }
    .hz-toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body>

  <aside class="sidebar" id="sidebar">
    <div class="brand"><img src="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/mainlogog-removebg-preview.png"></div>
    <ul class="nav-links">
      <li><a href="dashboard.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
      <li class="nav-item">
        <a href="#" id="bookingMenu"><i class="fa-solid fa-broom"></i> Bookings <i class="fa-solid fa-chevron-down" style="margin-left:auto;"></i></a>
        <div class="sub-menu"><a href="booking.html">Create New</a><a href="all-bookings.html">All Bookings</a></div>
      </li>
      <li><a href="properties.html"><i class="fa-solid fa-house"></i> Properties</a></li>
      <li><a href="cleaners.html" class="active"><i class="fa-solid fa-users"></i> Cleaners</a></li>
      <li><a href="reports.html"><i class="fa-solid fa-chart-pie"></i> Reports</a></li>
      <li><a href="settings.html"><i class="fa-solid fa-gear"></i> Settings</a></li>
    </ul>
  </aside>

  <div class="overlay" id="overlay"></div>

  <main>
    <div class="card">
      <div class="card__title">
        <span><i class="fa-solid fa-users"></i> Cleaners Management</span>

        <div class="filter-bar">
          <input type="text" id="searchInput" placeholder="Search cleaners...">
          <select id="statusFilter">
            <option value="all">All</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
          <button class="btn add" onclick="openDrawer()">+ Add Cleaner</button>
        </div>
      </div>

      <table id="cleanersTable">
        <thead>
          <tr>
            <th>ID</th><th>Name</th><th>Email</th><th>Phone</th>
            <th>Jobs</th><th>Earnings (Ex GST)</th><th>Outstanding</th>
            <th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <div class="drawer" id="drawer">
    <div class="drawer__header">
      <div style="display:flex;align-items:center;gap:10px;">
        <div class="avatar" id="drawerAvatar">CL</div>
        <span id="drawerTitle">Cleaner Details</span>
      </div>
      <i class="fa-solid fa-xmark" style="cursor:pointer;" onclick="closeDrawer()"></i>
    </div>

    <div class="drawer__body" id="drawerBody"></div>

    <div class="drawer__footer">
      <button class="btn" onclick="closeDrawer()">Close</button>
    </div>
  </div>

  <div class="hz-toast" id="toast"></div>

<script>
const scriptBaseURL = "https://corsproxy.io/?" + encodeURIComponent("https://script.google.com/macros/s/AKfycbx04byXSnZH_gzI2J7OQRCQzY3U40KmNmSKgydU-AbhI8zZSjgXOlZdspMXYoMzzJVM/exec");

let cleanersData = [];

async function loadCleaners() {
  const res = await fetch(`${scriptBaseURL}?type=cleanersList`);
  const data = await res.json();
  cleanersData = data;
  renderCleaners(data);
}

function renderCleaners(rows) {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const status = document.getElementById("statusFilter").value;
  const tbody = document.querySelector("#cleanersTable tbody");

  const filtered = rows.filter(c => {
    const active = (c["Active"] || "").toString().toLowerCase() === "yes";
    const matchesSearch = c["Cleaner Name"]?.toLowerCase().includes(search) || c["Email"]?.toLowerCase().includes(search);
    const matchesStatus =
      status === "all" ||
      (status === "active" && active) ||
      (status === "inactive" && !active);
    return matchesSearch && matchesStatus;
  });

  tbody.innerHTML = filtered.map(c => `
    <tr onclick='openDrawer(${JSON.stringify(c)})' style="cursor:pointer;">
      <td>${c["Cleaner ID"]}</td>
      <td>${c["Cleaner Name"]}</td>
      <td>${c["Email"]}</td>
      <td>${c["Phone"]}</td>
      <td>${c["Total Jobs Completed"] || 0}</td>
      <td>$${c["Total Earnings (Ex GST)"] || 0}</td>
      <td>$${c["Outstanding Balance"] || 0}</td>
      <td>${(c["Active"] || "").toString().toLowerCase() === "yes"
        ? '<span class="badge active">Active</span>'
        : '<span class="badge inactive">Inactive</span>'}</td>
      <td><i class="fa-solid fa-angle-right" style="color:#aaa;"></i></td>
    </tr>`).join("");
}

function openDrawer(c) {
  const body = document.getElementById("drawerBody");
  document.getElementById("drawerTitle").textContent = c["Cleaner Name"];
  document.getElementById("drawerAvatar").textContent = c["Cleaner Name"][0];
  body.innerHTML = `
    <p><strong>Email:</strong> ${c["Email"]}</p>
    <p><strong>Phone:</strong> ${c["Phone"]}</p>
    <p><strong>Status:</strong> ${(c["Active"] || "").toString().toLowerCase() === "yes" ? "ðŸŸ¢ Active" : "ðŸ”´ Inactive"}</p>
    <hr>
    <p><strong>Total Jobs Completed:</strong> ${c["Total Jobs Completed"] || 0}</p>
    <p><strong>Total Earnings (Ex GST):</strong> $${c["Total Earnings (Ex GST)"] || 0}</p>
    <p><strong>Outstanding Balance:</strong> $${c["Outstanding Balance"] || 0}</p>
  `;
  document.getElementById("drawer").classList.add("active");
  document.getElementById("overlay").classList.add("active");
}

function closeDrawer() {
  document.getElementById("drawer").classList.remove("active");
  document.getElementById("overlay").classList.remove("active");
}

document.getElementById("searchInput").oninput = () => renderCleaners(cleanersData);
document.getElementById("statusFilter").onchange = () => renderCleaners(cleanersData);

loadCleaners();
</script>
</body>
</html>
