<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HomeGlitz — Cleaner Payments</title>

<link rel="icon" href="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* -------------------------------------------
   THEME VARIABLES (same as cleaner-portal)
-------------------------------------------- */
:root{
  --primary:#0F72B4;
  --panel:#ffffff;
  --muted:#6c757d;
  --success:#16a34a;
  --danger:#ef4444;
  --radius:14px;
  --shadow:0 10px 30px rgba(12,60,120,.06);
  --max-w:1080px;
}

*{box-sizing:border-box;font-family:'Montserrat',sans-serif;}
html,body{margin:0;height:100%;background:#f5faff;color:#111;}

/* -------------------------------------------
   FIXED HEADER (same style as portal)
-------------------------------------------- */
.header{
  position:sticky;top:0;z-index:60;
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;background:#fff;border-bottom:1px solid #eef6fb;
  box-shadow:0 2px 10px rgba(12,60,120,0.02);
}
.header .brand{display:flex;align-items:center;gap:12px;color:var(--primary);font-weight:800}
.header img{height:38px;border-radius:8px}
.header-right{display:flex;align-items:center;gap:12px}

/* -------------------------------------------
   LAYOUT WRAPPER
-------------------------------------------- */
.page {max-width:var(--max-w);margin:20px auto;padding:0 16px}
.grid {display:grid;grid-template-columns:1fr 320px;gap:18px}
@media(max-width:980px){.grid{grid-template-columns:1fr}.side{display:none}}

/* -------------------------------------------
   SIDEBAR (desktop only)
-------------------------------------------- */
.side{
  background:#fff;border:1px solid #eaf2fb;border-radius:12px;
  padding:16px;height:fit-content;box-shadow:var(--shadow);
}
.profile{display:flex;gap:12px;align-items:center;margin-bottom:12px}
.avatar{
  width:42px;height:42px;border-radius:10px;background:#f0f6fb;
  display:flex;align-items:center;justify-content:center;
  color:var(--primary);font-weight:700;
}
.side a{
  display:block;padding:10px;border-radius:10px;margin-bottom:8px;
  text-decoration:none;font-weight:700;color:var(--muted);
}
.side a.active{
  background:#f8fbff;color:var(--primary);
  box-shadow:0 6px 18px rgba(15,114,180,.04);
}

/* -------------------------------------------
   CARD AND CONTENT
-------------------------------------------- */
.card{
  background:#fff;border-radius:14px;padding:20px;
  border:1px solid #eaf2fb;box-shadow:var(--shadow);
}

h2{margin:0;color:var(--primary);font-size:20px}
.section-title{
  margin-top:24px;margin-bottom:10px;color:var(--primary);
  font-weight:700;font-size:17px;
}

/* SUMMARY BOXES */
.summary-box{
  display:grid;gap:14px;grid-template-columns:1fr 1fr;margin-top:14px;
}
.sum{
  background:#f8fbff;border:1px solid #e6eef8;
  border-radius:12px;padding:16px;
}
.sum .value{font-size:22px;font-weight:700}
.sum .label{font-size:13px;color:var(--muted)}

@media(max-width:650px){
  .summary-box{grid-template-columns:1fr}
}

/* -------------------------------------------
   TABLE + MOBILE CARDS
-------------------------------------------- */
.table-wrap{overflow:auto;margin-top:10px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{
  padding:12px;border-bottom:1px solid #eef2f7;
  text-align:left;
}
th{background:#f9fbfd;color:var(--primary);font-weight:800}
tr:hover td{background:#fbfdff}

/* BADGE COLORS */
.badge{
  padding:5px 9px;border-radius:999px;font-size:12px;font-weight:700;
}
.b-pending{background:#fff7df;color:#b27a00}
.b-approved{background:#eaffec;color:#137c39}
.b-paid{background:#eaf4ff;color:#0a5ba8}

/* MOBILE – hide table, show cards */
@media(max-width:650px){
  table{display:none}
  .mobile-list{display:block;margin-top:12px}

  .mp-card{
    background:#fff;border-radius:14px;
    padding:16px;margin-bottom:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.04);
    border:1px solid #eef2f7;
  }
  .mp-top{font-weight:700;color:var(--primary);margin-bottom:6px}
  .mp-row{display:flex;justify-content:space-between;margin:4px 0;font-size:14px}
  .mp-label{color:var(--muted)}
}
@media(min-width:651px){.mobile-list{display:none}}

/* BOTTOM NAV (mobile) */
.bottom-nav{
  position:fixed;left:0;right:0;bottom:0;
  background:#fff;border-top:1px solid #eef6ff;
  display:flex;justify-content:space-around;z-index:80;
  padding:8px 6px;
}
.bottom-nav a{
  flex:1;text-align:center;text-decoration:none;font-weight:700;
  color:var(--muted);padding:6px;
}
.bottom-nav a.active{color:var(--primary)}

/* TOP PROGRESS BAR */
#topProgressBar{
  position:fixed;top:0;left:0;height:3px;width:0%;
  background:var(--primary);z-index:9999;transition:width .35s ease;
}
</style>
</head>

<body>

<div id="topProgressBar"></div>

<!-- HEADER -->
<header class="header">
  <div class="brand">
    <img src="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/mainlogog-removebg-preview.png">
  </div>

  <div class="header-right">
    <span id="cleanerNameTop" style="font-size:14px;color:var(--muted)"></span>
    <button class="btn ghost" id="btnLogout" style="border:1px solid #e6eef8;padding:8px 10px;border-radius:10px;">
      <i class="fa-solid fa-right-from-bracket"></i>
    </button>
  </div>
</header>

<!-- PAGE -->
<main class="page">
  <div class="grid">

    <!-- MAIN CONTENT -->
    <section>
      <div class="card">

        <h2>Payments</h2>

        <div class="summary-box">
          <div class="sum">
            <div class="value" id="totalEarnings">$0</div>
            <div class="label">Total Earnings</div>
          </div>
          <div class="sum">
            <div class="value" id="totalPaid">$0</div>
            <div class="label">Paid Out</div>
          </div>
        </div>

        <div class="section-title">Payment Requests</div>

        <!-- DESKTOP TABLE -->
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Property</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Requested</th>
              </tr>
            </thead>
            <tbody style= "margin-bottom:100px;" id="paymentsBody">
              <tr><td colspan="4" style="text-align:center;color:var(--muted);padding:20px">Loading…</td></tr>
            </tbody>
          </table>
        </div>

        <!-- MOBILE CARDS -->
        <div style= "margin-bottom:55px;" class="mobile-list" id="paymentsMobile"></div>

      </div>
    </section>

    <!-- SIDEBAR -->
    <aside class="side">
      <div class="profile">
        <div class="avatar" id="sideAvatar">CL</div>
        <div>
          <div id="sideName" style="font-weight:800">Cleaner</div>
          <div id="sideEmail" style="font-size:13px;color:var(--muted)"></div>
        </div>
      </div>

      <nav>
        <a href="/homeglitz/cleaner/portal.html"><i class="fa-solid fa-list-check"></i> My Jobs</a>
        <a href="/homeglitz/cleaner/payments.html" class="active"><i class="fa-solid fa-wallet"></i> Payments</a>
        <a href="/homeglitz/others/coming-soon.html"><i class="fa-solid fa-gear"></i> Account</a>
      </nav>
    </aside>

  </div>
</main>

<!-- MOBILE NAV -->
<nav class="bottom-nav">
  <a href="/homeglitz/cleaner/portal.html"><i class="fa-solid fa-list-check"></i><div style="font-size:12px">Jobs</div></a>
  <a href="#" class="active"><i class="fa-solid fa-wallet"></i><div style="font-size:12px">Payments</div></a>
  <a href="/homeglitz/others/coming-soon.html"><i class="fa-solid fa-gear"></i><div style="font-size:12px">Account</div></a>
</nav>

<script>
const API = "https://homeglitz.raphaellevinders.workers.dev/";

let token      = localStorage.getItem("homeglitz_cleaner_token");
let cleanerId  = localStorage.getItem("homeglitz_cleaner_id");
let name       = localStorage.getItem("homeglitz_cleaner_name");
let email      = localStorage.getItem("homeglitz_cleaner_email");

if(!token || !cleanerId){
  location.href = "/homeglitz/cleaner/login.html";
}

/* Fill UI */
document.getElementById("cleanerNameTop").textContent = name || "";
document.getElementById("sideName").textContent = name || "";
document.getElementById("sideEmail").textContent = email || "";
document.getElementById("sideAvatar").textContent = (name||"CL").split(" ").map(s=>s[0]).join("").toUpperCase();

/* Logout */
document.getElementById("btnLogout").onclick = () => {
  localStorage.clear();
  location.href="/homeglitz/cleaner/login.html";
};

/* PROGRESS BAR */
function progressStart(){
  const bar = document.getElementById("topProgressBar");
  bar.style.width="0%";
  bar.style.display="block";
  setTimeout(()=>bar.style.width="40%",80);
}
function progressFinish(){
  const bar = document.getElementById("topProgressBar");
  bar.style.width="100%";
  setTimeout(()=>{bar.style.display="none";bar.style.width="0%"},450);
}

/* LOAD PAYMENTS */
async function loadPayments(){
  progressStart();
  try{
    const res = await fetch(API, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ action:"getCleanerPayments", token })
    });

    const json = await res.json();
    progressFinish();

    if(!json.success){
      alert(json.message || "Unable to load payments");
      return;
    }

    document.getElementById("totalEarnings").textContent = "$" + (json.totalEarnings||0);
    document.getElementById("totalPaid").textContent     = "$" + (json.totalPaid||0);

    const list = json.payments || [];
    renderDesktop(list);
    renderMobile(list);

  }catch(e){
    progressFinish();
    console.error(e);
    alert("Network error");
  }
}

function renderDesktop(list){
  const tbody = document.getElementById("paymentsBody");
  if(list.length===0){
    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:20px">No payment requests</td></tr>`;
    return;
  }

  tbody.innerHTML = list.map(p=>{
    const cls = p.Status==="Pending" ? "b-pending" :
                p.Status==="Approved" ? "b-approved" :
                "b-paid";

    return `
      <tr>
        <td>${p["Property Name"] || "—"}</td>
        <td>$${p.Amount}</td>
        <td><span class="badge ${cls}">${p.Status}</span></td>
        <td>${new Date(p["Requested At"]).toLocaleDateString()}</td>
      </tr>
    `;
  }).join("");
}

function renderMobile(list){
  const mobile = document.getElementById("paymentsMobile");
  if(list.length===0){
    mobile.innerHTML = `<div style="padding:18px;text-align:center;color:var(--muted)">No payment requests</div>`;
    return;
  }

  mobile.innerHTML = list.map(p=>{
    const cls = p.Status==="Pending" ? "b-pending" :
                p.Status==="Approved" ? "b-approved" :
                "b-paid";

    return `
      <div class="mp-card">
        <div class="mp-top">${p["Property Name"] || "Property"}</div>

        <div class="mp-row"><span class="mp-label">Amount:</span> $${p.Amount}</div>
        <div class="mp-row"><span class="mp-label">Status:</span> <span class="badge ${cls}">${p.Status}</span></div>
        <div class="mp-row"><span class="mp-label">Requested:</span> ${new Date(p["Requested At"]).toLocaleDateString()}</div>
      </div>
    `;
  }).join("");
}

loadPayments();


</script>
</body>
</html>
