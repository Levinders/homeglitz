<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HomeGlitz â€” Admin Booking</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/64%C3%9764pxlogo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0F72B4;
      --primary-light: #f5faff;
      --text: #222;
      --muted: #6c757d;
      --panel: #fff;
      --border: #e4e9ef;
      --radius: 12px;
      --shadow: 0 6px 20px rgba(15,114,180,0.1);
      --transition: 0.3s ease;
    }

    * { box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
    html, body { margin: 0; padding: 0; overflow-x: hidden; }
    body { display: flex; min-height: 100vh; background: var(--primary-light); color: var(--text); }

    /* === SIDEBAR === */
    .sidebar {
      position: fixed; left: 0; top: 0; bottom: 0;
      width: 250px; background: var(--panel); border-right: 1px solid var(--border);
      box-shadow: var(--shadow); display: flex; flex-direction: column;
      padding: 20px 0; overflow-y: auto; z-index: 2000;
    }

    .sidebar .brand { display: flex; align-items: center; justify-content: center; margin-bottom: 30px; }
    .sidebar .brand img { height: 48px; transition: all var(--transition); }

    .nav-links { list-style: none; padding: 0; margin: 0; }

    .nav-item { position: relative; }
    .nav-links li a { display: flex; align-items: center; gap: 12px; padding: 14px 22px; color: var(--muted); font-weight: 500; text-decoration: none; transition: all var(--transition); }
    .nav-links li a:hover, .nav-links li a.active { background: var(--primary-light); color: var(--primary); border-left: 4px solid var(--primary); }

    .sub-menu { display: none; flex-direction: column; margin-left: 40px; }
    .sub-menu a { font-size: 14px; color: var(--muted); padding: 8px 0; transition: 0.2s; }
    .sub-menu a:hover { color: var(--primary); }
    .nav-item.open .sub-menu { display: flex; }

    /* === TOPBAR === */
    .topbar { height: 60px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 25px; box-shadow: var(--shadow); position: fixed; top: 0; left: 250px; right: 0; z-index: 1000; }

    .menu-toggle { background: none; border: none; font-size: 20px; color: var(--primary); cursor: pointer; }

    .topbar-right { display: flex; align-items: center; gap: 20px; color: var(--muted); }

    /* === MAIN === */
    main { flex: 1; margin-left: 250px; padding: 100px 40px 40px; background: var(--primary-light); }

    .card { background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); padding: 40px 50px; }

    h2.card__title { font-size: 22px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid rgba(15,114,180,0.1); padding-bottom: 10px; }

    form { display: flex; flex-direction: column; gap: 24px; }

    .form__row { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
    .form__row-inline { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

    .form__group { display: flex; flex-direction: column; gap: 8px; }

    label { font-weight: 600; color: var(--primary); font-size: 15px; display: flex; align-items: center; gap: 8px; }

    select, input, textarea { border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px; font-size: 15px; color: var(--text); background: #fdfdfd; transition: all var(--transition); }

    select:focus, input:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(15,114,180,0.1); }

    .property-info { margin-top: 6px; font-size: 14px; color: var(--muted); background: #f8fbff; padding: 10px 12px; border-radius: 8px; border-left: 3px solid var(--primary); }

    .b2b-group { background: #f8fbff; border-radius: var(--radius); border: 1px solid var(--border); padding: 5px 18px; }
    .linen-badge-group { display: flex; align-items: center; gap: 12px; }

    .linen-badge { flex: 1; text-align: center; padding: 10px 16px; border-radius: 20px; font-weight: 600; border: 1px solid rgba(15,114,180,0.25); background: rgba(15,114,180,0.08); color: var(--primary); cursor: pointer; transition: all 0.3s ease; }
    .linen-badge.active { background: var(--primary); color: #fff; box-shadow: 0 0 8px rgba(15,114,180,0.3); }

    .toolbar { display: flex; justify-content: flex-end; gap: 16px; margin-top: 10px; }

    .btn { border: none; border-radius: 8px; padding: 13px 30px; font-weight: 600; cursor: pointer; font-size: 15px; transition: all var(--transition); }
    .btn-save { background: var(--primary); color: #fff; box-shadow: 0 4px 10px rgba(15,114,180,0.2); }
    .btn-save:hover { background: #0d5f95; transform: translateY(-1px); }
    .btn-reset { background: #f1f3f5; color: var(--muted); }
    .btn-reset:hover { background: #e9ecef; }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.25); backdrop-filter: blur(3px); opacity: 0; visibility: hidden; transition: all var(--transition); z-index: 1500; }
    .overlay.active { opacity: 1; visibility: visible; }

    @media (max-width: 900px) {
      .sidebar { left: -250px; }
      .sidebar.open { left: 0; }
      .topbar { left: 0; right: 0; }
      main { margin-left: 0; padding: 100px 20px 40px; }
      .form__row, .form__row-inline { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/Levinders/homeglitz/refs/heads/main/mainlogog-removebg-preview.png" alt="HomeGlitz Logo">
    </div>
    <ul class="nav-links">
      <li><a href="dashboard.html"><i class="fa-solid fa-chart-line"></i><span> Dashboard</span></a></li>
      <li class="nav-item">
        <a href="#" id="bookingMenu"><i class="fa-solid fa-broom"></i><span> Bookings</span><i class="fa-solid fa-chevron-down" style="margin-left:auto;"></i></a>
        <div class="sub-menu">
          <a href="booking.html">Create New</a>
          <a href="all-bookings.html">All Bookings</a>
        </div>
      </li>
      <li><a href="properties.html"><i class="fa-solid fa-house"></i><span> Properties</span></a></li>
      <li><a href="cleaners.html"><i class="fa-solid fa-users"></i><span> Cleaners</span></a></li>
      <li><a href="reports.html"><i class="fa-solid fa-chart-pie"></i><span> Reports</span></a></li>
      <li><a href="settings.html"><i class="fa-solid fa-gear"></i><span> Settings</span></a></li>
    </ul>
  </aside>

  <div class="overlay" id="overlay"></div>

  <div style="flex:1; display:flex; flex-direction:column;">
    <header class="topbar">
      <button class="menu-toggle" id="menuToggle"><i class="fa-solid fa-bars"></i></button>
      <div class="topbar-right">
        <i class="fa-regular fa-bell"></i>
        <i class="fa-regular fa-user"></i>
      </div>
    </header>

    <main>
      <div class="card">
        <h2 class="card__title"><i class="fa-solid fa-broom"></i> Create New Booking</h2>

        <form id="bookingForm" autocomplete="off">
          <div class="form__row">
            <div class="form__group">
              <label><i class="fa-solid fa-layer-group"></i> Property Type</label>
              <select id="propertyType" required>
                <option value="">Select type...</option>
                <option value="airbnb">Airbnb Property</option>
                <option value="office">Home / Office Property</option>
              </select>
            </div>

            <div class="form__group">
              <label><i class="fa-solid fa-house-chimney"></i> Property</label>
              <select id="property" required>
                <option value="">Select property...</option>
              </select>
              <div class="property-info" id="propertyInfo"></div>
            </div>
          </div>

          <div class="form__row-inline">
            <div class="form__group">
              <label><i class="fa-regular fa-calendar"></i> Cleaning Date</label>
              <input id="date" type="date" required />
            </div>
            <div class="form__group b2b-group">
              <label><i class="fa-solid fa-briefcase"></i> B2B</label>
              <div class="linen-badge-group">
                <div class="linen-badge" id="b2bYes">Yes</div>
                <div class="linen-badge active" id="b2bNo">No</div>
              </div>
            </div>
          </div>

          <div class="form__group">
            <label><i class="fa-solid fa-user"></i> Cleaner</label>
            <select id="cleaners"><option value="">Select cleaner...</option></select>
          </div>

          <div class="form__group">
            <label><i class="fa-regular fa-note-sticky"></i> Notes</label>
            <textarea id="notes" rows="3" placeholder="Door code, supplies, or special requests..."></textarea>
          </div>

          <div class="toolbar">
            <button id="submitBtn" type="submit" class="btn btn-save"><i class="fa-solid fa-check"></i> Save Booking</button>
            <button id="resetBtn" type="button" class="btn btn-reset"><i class="fa-solid fa-rotate-left"></i> Reset</button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuToggle = document.getElementById('menuToggle');
    const bookingMenu = document.getElementById('bookingMenu');
    const bookingItem = bookingMenu.parentElement;

    menuToggle.onclick = () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
    };

    overlay.onclick = () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
    };

    bookingMenu.onclick = (e) => {
      e.preventDefault();
      bookingItem.classList.toggle('open');
    };

    const scriptBaseURL = "https://corsproxy.io/?" + encodeURIComponent("https://script.google.com/macros/s/AKfycbwGjcHGPAHRyrenw3HmIpkT8U3Zw7RE2j1rhj8bZMyIc59tnI4Vj8bjY3evvq_X0ls/exec");

    async function loadDropdowns() {
      try {
        const propSel = document.getElementById('property');
        const cleanSel = document.getElementById('cleaners');

        const propRes = await fetch(`${scriptBaseURL}?type=properties`, { cache: "no-store" });
        const propData = await propRes.json();

        propSel.innerHTML = `<option value=''>Select property...</option>`;
        propData.forEach(p => propSel.innerHTML += `<option value='${p.name}'>${p.name}</option>`);

        const cleanerRes = await fetch(`${scriptBaseURL}?type=cleaners`, { cache: "no-store" });
        const cleanerData = await cleanerRes.json();

        cleanSel.innerHTML = `<option value=''>Select cleaner...</option>`;
        cleanerData.forEach(c => cleanSel.innerHTML += `<option value='${c.name}'>${c.name}</option>`);
      } catch (err) {
        console.error('Error loading data:', err);
      }
    }

    loadDropdowns();

    // === Form Handling ===
    const yesBtn = document.getElementById('b2bYes');
    const noBtn = document.getElementById('b2bNo');
    yesBtn.onclick = () => { yesBtn.classList.add('active'); noBtn.classList.remove('active'); };
    noBtn.onclick = () => { noBtn.classList.add('active'); yesBtn.classList.remove('active'); };

    document.getElementById('resetBtn').onclick = () => {
      document.getElementById('bookingForm').reset();
      noBtn.classList.add('active'); yesBtn.classList.remove('active');
    };

    document.getElementById('bookingForm').onsubmit = async (e) => {
      e.preventDefault();
      const data = {
        propertyType: propertyType.value,
        property: property.value,
        date: date.value,
        cleaner: cleaners.value,
        b2b: document.querySelector('.linen-badge.active').textContent,
        notes: notes.value
      };
      try {
        const res = await fetch(scriptBaseURL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        const result = await res.json();
        alert('Booking saved successfully!');
        document.getElementById('bookingForm').reset();
        noBtn.classList.add('active'); yesBtn.classList.remove('active');
      } catch (err) {
        alert('Error saving booking');
        console.error(err);
      }
    };
  </script>
</body>
</html>
